<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title> Black Hole </title>
	<!-- bootstrap reset -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link rel="stylesheet" href="style.css" type ="text/css">
</head>
<body>
	<!-- My JS files -->
<script>
const handleResponse = async (response, parseResponse) => {

	// get json back
	let h1;
	let p;

	// get content and then create h1 / p if needed - otherwise, just get them
	const content = document.querySelector('#game');
	if (document.body.contains(document.querySelector("#statusTitle"))) {
	h1 = document.querySelector('#statusTitle');
	p = document.querySelector('#statusMessage');
	} else {
	h1 = document.createElement('h1');
	h1.setAttribute("id", "statusTitle");
	p = document.createElement('p');
	p.setAttribute("id", "statusMessage");
	}



	const statusCodes = {
	200: `<b>Success</b>`,
	201: `<b>Created</b>`,
	204: `<b>Updated (No Content)</b>`,
	400: `<b>Bad Request</b>`,
	404: `<b>Not Found</b>`
	};

	h1.innerHTML = statusCodes[response.status];
	if (parseResponse && response.status !== 204) {
	const parsedResponse = await response.json();
	// if the message is good (aka is the users obj)
	p.innerHTML = response.status === 200 
	// then display that
	? JSON.stringify(parsedResponse.users)
	// otherwise, display the error
	: `Message: ${JSON.stringify(parsedResponse.message)}`;
	} else {
	p.innerHTML = "";
	}

	//Add the elements to the screen.
	content.appendChild(h1);
	content.appendChild(p);    
	};

	const sendGetRequest = async (getUserForm) => {

	// get url / method from form, as it can change
	const url = getUserForm.querySelector('#urlField');
	const method = getUserForm.querySelector('#methodSelect');

	// build response for get OR head using url / method consts
	let response = await fetch (url.value, {
		method: method.value,
		headers: {
		'Accept': 'application/json'
		},
	});

	// handle the response
	handleResponse(response, method.value === 'get');
	};

	const sendPost = async (addUserForm) => {

	const action = addUserForm.getAttribute('action');
	const method = addUserForm.getAttribute('method');

	const name = nameForm.querySelector('#nameField');
	const age = nameForm.querySelector('#ageField');

	const formData = `name=${name.value}&age=${age.value}`; 

	let response = await fetch(action, {
		method: method,
		headers: {
		'Content-Type': 'application/x-www-form-urlencoded',
		'Accept': 'application/json',
		},
		body: formData,
	});

	// always print a response for post
	handleResponse(response, true);
	};

	const init = () => {

	};

	window.onload = init;
</script>
<div id="gameContainer">
	<h3>API Test</h3>
	<form id="getForm" method="get">
		<label for="gameID">GameID </label>
		<input id="gameIDField" type="text" name="gameID"/>
		<label for="player">Player: </label>
		<select id="playerField" name="player">
			<option value="Red">Red</option>
			<option value="Blue">Blue</option>
		</select>
		<select id="methodSelect">
			<option value="get">GET</option>
			<option value="head">HEAD</option>
		  </select>
		<input type="submit" value="Get Thing" />
	  </form>
	  <form id="postForm" method="post">
		<select id='urlField'>
		  <option value='/getUsers'>/getUsers</option>
		  <option value='/notReal'>/notReal</option>
		</select>
		<select id="methodSelect">
		  <option value="get">GET</option>
		  <option value="head">HEAD</option>
		</select>
		<input type="submit" value="Get User" />
	  </form>
</div>
</body>
</html>