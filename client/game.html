<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title> Black Hole </title>
	<!-- bootstrap reset -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="style.css" type ="text/css">
    <script src="/src/webComponents/webCpt-title.js"></script>
</head>
<body>
<script>

const handleResponse = async (response, parseResponse) => {

	// get json back
	let h1;
	let p;

	// get content and then create h1 / p if needed - otherwise, just get them
	const content = document.querySelector('#result');
	h1 = document.querySelector('#h1');
	p = document.querySelector('#p');

	const statusCodes = {
	200: `<b>Success</b>`,
	201: `<b>Created</b>`,
	204: `<b>Updated (No Content)</b>`,
	400: `<b>Bad Request</b>`,
	404: `<b>Not Found</b>`,
	409: `<b>Data Conflict</b>`
	};

	h1.innerHTML = statusCodes[response.status];
	if (parseResponse && response.status !== 204) {
	const parsedResponse = await response.json();

	// if the message is good (aka is the users obj)
	// then display that
	// otherwise, display the error
	p.innerHTML = response.status === 200 
	? JSON.stringify(parsedResponse.message)
	: `Message: ${JSON.stringify(parsedResponse.message)}`;
	} else {
	p.innerHTML = "";
	}

	//Add the elements to the screen.
	content.appendChild(h1);
	content.appendChild(p);    
	};

	const joinGame = async (joinGameForm) => {
	// build response for get OR head using url / method consts
    let gameID = joinGameForm.querySelector("#gameIDField").value;
    //let url = `/getGame?gameID=${gameID}`;
    console.log(gameID);
	let response = await fetch ("/joinGame?gameID=" + gameID, {
		method: "GET",
		headers: {
		'Accept': 'application/json'
		},
	});

	// handle the response
	handleResponse(response, true);
	};

	const createGame = async (createGameForm) => {
	let response = await fetch("/createGame", {
		method: "POST",
		headers: {
		'Content-Type': 'application/x-www-form-urlencoded',
		'Accept': 'application/json',
		},
		body: `gameID=${createGameForm.querySelector('#gameIDField').value}`,
	});

	// always print a response for post
	handleResponse(response, true);
	};

	const init = () => {
	  const joinGameForm = document.querySelector('#joinGameForm');
      const createGameForm = document.querySelector('#createGameForm');

	  // create functions to override initial form functions
	  const joinGameFormAction = (e) => {
        e.preventDefault();
        joinGame(joinGameForm);
        return false;
      };

      const createGameFormAction = (e) => {
        e.preventDefault();
        createGame(createGameForm);
        return false;
      };

	  // attach evt listeners to forms
	  joinGameForm.addEventListener('submit', joinGameFormAction);
      createGameForm.addEventListener('submit', createGameFormAction);

	};

	window.onload = init;
</script>

  <!-- navbar web component - check src/dadabase-navbar -->
<webcpt-navbar data-current-page="app" class="is-centered"></webcpt-navbar>

<div id="appContainer" class="container">
    <div id="homeScreen">
        <webcpt-title data-text="Black Hole"></webcpt-title>
    
        <div class="box mt-5 has-text-centered">
            <h3 class="subtitle">Join Existing Game</h3>
            <form id="joinGameForm" method="get">
                <div class="field is-grouped is-grouped-centered">
                    <label class="label" for="gameID">GameID</label>
                    <div class = "control">
                        <input id="gameIDField" type="text" name="gameID" placeholder="4-Letter Game ID"/>
                    </div>
                    <div class = "control">
                        <input type="submit" value="Join Game"/>
                    </div>
                </div>
            </form>
        </div>
    
        <div class="box mt-5 has-text-centered">
            <h3 class="subtitle">Create New Game</h3>
            <form id="createGameForm" method="post" class="container">
                <div class="field is-grouped is-grouped-centered">
                    <label class="label" for="gameID">GameID (optional)</label>
                    <div class="control">
                        <input id="gameIDField" type="text" name="gameID" placeholder="4-Letter Game ID"/>
                    </div>
                    <div class = "control">
                        <input type="submit" value="Create New Game"/>
                    </div>
                </div>
            </form>
        </div>
    
          <div id="result">
            <h1 id="h1">No return yet...</h1>
            <p id="p"></p>
          </div>
    </div>
    
    <div id="gameContainer" class="container"> 

    </div>
</div>


  
</div>
</body>
</html>